# ============================================================
# TT2025 - application-prod.properties (Render / PROD)
# ------------------------------------------------------------
# Objetivo:
# - Despliegue en Render (Docker) con Spring Boot (WAR ejecutable)
# - Sin secretos en repo: credenciales por variables de entorno
# - Puerto compatible con Render: usa PORT si existe
# - Hibernate NO crea/modifica esquema (solo valida)
# - Flyway aplica migraciones (V1..Vn)
# ============================================================

# Perfil recomendado (defínelo en Render):
#   SPRING_PROFILES_ACTIVE=prod

# ============================================================
# 0) SERVER (Render)
# ============================================================

# Render inyecta PORT; si no existe, usa 8080
server.port=${PORT:8080}

# ============================================================
# 1) DATASOURCE (MariaDB Cloud)
# ============================================================

# Define estas variables en Render:
#   SPRING_DATASOURCE_URL=jdbc:mariadb://HOST:PORT/tt2025?sslMode=verify-ca
#   SPRING_DATASOURCE_USERNAME=...
#   SPRING_DATASOURCE_PASSWORD=...
#
# Nota TLS/SSL:
# - Si tu proveedor exige CA cert, tendrás que referenciar una ruta Linux
#   dentro del contenedor (no rutas Windows). En ese caso, ajusta la URL en Render.

spring.datasource.url=${SPRING_DATASOURCE_URL}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver

# ============================================================
# 2) JPA / HIBERNATE
# ============================================================

# validate:
# - NO crea/actualiza tablas
# - valida que el esquema coincide con las entidades
spring.jpa.hibernate.ddl-auto=validate

# Buenas prácticas
spring.jpa.open-in-view=false
spring.jpa.show-sql=false

# ============================================================
# 3) FLYWAY
# ============================================================

spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration

# ============================================================
# 4) HIKARI (serverless-friendly)
# ============================================================

# Variables opcionales en Render:
#   TT2025_DB_POOL_MAX=5
#   TT2025_DB_POOL_MIN=0

spring.datasource.hikari.maximum-pool-size=${TT2025_DB_POOL_MAX:5}
spring.datasource.hikari.minimum-idle=${TT2025_DB_POOL_MIN:0}
spring.datasource.hikari.idle-timeout=30000
spring.datasource.hikari.max-lifetime=600000
spring.datasource.hikari.keepalive-time=0
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.initialization-fail-timeout=0

# ============================================================
# 5) THYMELEAF / LOGGING
# ============================================================

spring.thymeleaf.cache=true
logging.level.root=INFO

# ============================================================
# 6) SWAGGER / OPENAPI (apagado en prod)
# ============================================================

springdoc.swagger-ui.enabled=false
springdoc.api-docs.enabled=false

# ============================================================
# 7) SMTP (apagado en prod)
# ============================================================

app.mail.enabled=false
app.mail.from=no-reply@tt2025.local

# (Opcional) Por seguridad extra, desactivar devtools explícitamente en prod
spring.devtools.restart.enabled=false
spring.devtools.livereload.enabled=false
