<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
	th:replace="~{layout/base :: html(pageTitle='Servicios (cliente)', content=~{::content})}">

<section th:fragment="content">

	<div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
		<div class="me-2">
			<h1 class="h4 mb-1">Cat√°logo de servicios</h1>
			<div class="text-muted small">
				Selecciona <strong>un servicio</strong> para tu pr√≥xima cita.
			</div>
		</div>
	</div>

	<div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

	<!-- Buscador -->
	<form class="row g-2 mb-3" method="get" th:action="@{/cliente/servicios}">
		<div class="col-12 col-md-7">
			<div class="tt-form-row">
				<label class="form-label mb-0 tt-show-mobile">Buscar</label>
				<input class="form-control tt-mobile-full" type="search" name="q"
					placeholder="Buscar por nombre o c√≥digo..." th:value="${q}">
			</div>
		</div>

		<div class="col-12 col-md-3">
			<div class="tt-form-row">
				<label class="form-label mb-0 tt-show-mobile">Ordenar</label>
				<select class="form-select tt-mobile-full" name="sort">
					<option value="nombre" th:selected="${sort=='nombre'}">Orden: Nombre</option>
					<option value="precio" th:selected="${sort=='precio'}">Orden: Precio</option>
					<option value="duracion" th:selected="${sort=='duracion'}">Orden: Duraci√≥n</option>
				</select>
			</div>
		</div>

		<div class="col-12 col-md-2 d-grid">
			<button class="btn btn-outline-primary tt-btn-mobile" type="submit">Filtrar</button>
		</div>
	</form>

	<!-- üîë √öNICO FORM: seleccionar + reservar -->
	<form method="post" th:action="@{/cliente/servicios/seleccion-y-reservar}" th:object="${selectionForm}"
		id="serviceForm">

		<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

		<div class="row g-3">
			<div class="col-12" th:if="${#lists.isEmpty(services)}">
				<div class="alert alert-warning mb-0">
					No hay servicios que coincidan con tu b√∫squeda.
				</div>
			</div>

			<div class="col-12 col-md-6 col-lg-4" th:each="s : ${services}">

				<!-- Card clicable (label) para mejorar UX en m√≥vil -->
				<label class="card h-100 shadow-sm border-0" style="cursor:pointer;" th:for="${'srv_' + s.id}">

					<div class="card-body">

						<div class="d-flex justify-content-between align-items-start gap-2">
							<div class="me-2">
								<div class="fw-semibold tt-break" th:text="${s.nombre}">Servicio</div>
								<div class="text-muted small tt-break" th:text="${s.codigo}">SRV-001</div>
							</div>

							<div class="form-check m-0">
								<input class="form-check-input service-radio" type="radio" th:field="*{serviceId}"
									th:value="${s.id}" th:id="${'srv_' + s.id}">
							</div>
						</div>

						<p class="mt-2 mb-3 small text-secondary tt-break"
							th:text="${s.descripcion ?: 'Sin descripci√≥n'}"></p>

						<div class="d-flex justify-content-between align-items-center">
							<span class="badge text-bg-success tt-nowrap"
								th:text="${#numbers.formatDecimal(s.precioBase, 1, 'COMMA', 2, 'POINT')} + ' ‚Ç¨'">
								0,00 ‚Ç¨
							</span>

							<span class="badge text-bg-secondary tt-nowrap" th:text="${s.minutosEstimados} + ' min'">
								30 min
							</span>
						</div>

					</div>
				</label>

			</div>
		</div>

		<!-- CTA -->
		<div class="d-flex flex-column flex-sm-row justify-content-start gap-2 mt-4">
			<button class="btn btn-primary tt-btn-mobile" id="reserveBtn" type="submit" disabled>
				Reservar cita
			</button>

			<a class="btn btn-outline-secondary tt-btn-mobile" th:href="@{/cliente}">
				Volver
			</a>
		</div>

	</form>

</section>

</html>